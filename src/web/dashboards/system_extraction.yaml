# System Overview Dashboard Configuration
# Landing page showing overall system metrics across all workspaces

dashboard:
  id: system_extraction
  name: System Overview
  description: Overall system metrics across all extracted workspaces and sessions
  icon: chart-bar
  is_system_level: true     # Flag to indicate this is a system-wide dashboard

# Primary metrics row - key statistics at the top
metrics:
  - id: total_workspaces
    title: Workspaces
    description: Total extracted workspaces
    data_source:
      type: function
      function: get_system_stats
      field: total_workspaces
    format: number
    icon: folder
    color: blue

  - id: total_sessions
    title: Sessions
    description: Total chat sessions
    data_source:
      type: function
      function: get_system_stats
      field: total_sessions
    format: number
    icon: message-square
    color: green

  - id: total_turns
    title: Turns
    description: Total turns user/assistant
    data_source:
      type: function
      function: get_system_stats
      field: total_turns
    format: number
    icon: messages
    color: purple

  - id: total_code_lines
    title: Lines of Code
    description: Total lines of code generated
    data_source:
      type: function
      function: get_system_stats
      field: total_code_lines
    format: number
    icon: code
    color: cyan

  - id: top_agent
    title: Top Agent
    description: Most frequently used agent
    data_source:
      type: function
      function: get_top_agent_stats
      field: top_agent
    subtitle_field: percentage
    format: text
    icon: smart_toy
    color: purple

  - id: top_model
    title: Top Model
    description: Most frequently used AI model
    data_source:
      type: function
      function: get_top_model_stats
      field: top_model
    subtitle_field: percentage
    format: text
    text_size: sm
    icon: psychology
    color: pink


  - id: agentic_coding_time_days
    title: Agentic Time
    description: Total days spent coding by agents
    data_source:
      type: function
      function: get_agentic_coding_time_stats
      field: total_days
    format: number
    icon: timer
    color: orange


# Charts section
charts:

  # Activity Heatmap - agentic time minutes by date x hour
  - id: activity_heatmap_agentic_time
    title: Activity Heatmap
    description: Weekly minutes spent with agentic coding by date/week and hour
    chart_type: heatmap
    width: full
    data_source:
      type: function
      function: get_activity_heatmap_agentic_time
    x_field: date
    y_field: hour
    value_field: minutes
    options:
      color: '#3b82f6' # Blue
      cell_size: 14
      y_range: [0, 23]  # Show all 24 hours
      x_min_span_days: 90  # Show at least 3 months of dates

  # Agent usage distribution (Copilot vs Cursor)
  - id: agent_distribution
    title: Agent Usage
    description: Distribution by AI coding assistant
    chart_type: doughnut
    width: half
    data_source:
      type: function
      function: get_agent_distribution

  # Model usage distribution
  - id: model_usage
    title: Model Usage
    description: Top AI models used across all agents and conversations
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_model_distribution
    options:
      max_items: 10


  # Activity timeline - stacked bar chart showing sessions, turns, and files touched over time
  - id: session_timeline
    title: Activity Timeline
    description: Sessions, turns, and files touched over time
    chart_type: stacked_bar_timeline
    width: full
    x_field: date
    datasets:
      - label: Sessions
        field: sessions
        color: 'rgba(59, 130, 246, 0.8)' # Blue
        fill: false
      - label: Turns
        field: turns
        color: 'rgba(168, 85, 247, 0.8)' # Purple
        fill: false
      - label: Files Touched
        field: files_touched
        color: 'rgba(234, 179, 8, 0.8)' # Yellow
        fill: false
    data_source:
      type: function
      function: get_session_timeline


  # Agentic coding time by agent (Copilot vs Cursor vs Claude...)
  - id: agentic_coding_time_per_agent
    title: Coding Time by Agent
    description: Total time agents spent handling user requests (hours)
    chart_type: pie
    width: half
    data_source:
      type: function
      function: get_agentic_coding_time_per_agent
    options:
      max_items: 10
      show_percentages: trues

  # Agentic coding time by model (response_time_ms aggregated)
  - id: agentic_coding_time_per_model
    title: Coding Time by Model
    description: Total time a particular coding model spent handling user requests (hours)
    chart_type: pie
    width: half
    data_source:
      type: function
      function: get_agentic_coding_time_per_model
    options:
      max_items: 10
      show_percentages: true

  # Code velocity timeline (net code growth per day)
  - id: code_velocity_timeline
    title: Code Velocity Timeline
    description: Daily net code growth (added - removed)
    chart_type: line
    width: full
    x_field: date
    datasets:
      - label: Net Lines Added
        field: net_growth
        color: 'rgba(34, 197, 94, 0.8)' # Green
        fill: false
    data_source:
      type: function
      function: get_code_velocity_timeline


  # TODO: Implement proper stacked area chart with dynamic datasets

  # Model Productivity Matrix (table) - LOC per code turn by model
  - id: model_productivity_matrix
    title: Model Productivity Matrix
    description: LOC added per code turn by model
    chart_type: table
    width: full
    data_source:
      type: function
      function: get_model_productivity_matrix
    columns:
      - field: model
        title: Model
      - field: loc_per_turn
        title: LOC/Turn
      - field: total_loc_added
        title: Total LOC Added
      - field: code_turns
        title: Code Turns

  # Model Complexity Impact (scatter) - delta complexity vs lines changed
  - id: model_complexity_impact
    title: Model Complexity Impact
    description: Complexity delta vs lines changed (one point per model)
    chart_type: scatter
    width: half
    data_source:
      type: function
      function: get_model_complexity_impact
    x_field: lines_changed
    y_field: complexity_delta
    label_field: model

  # Code Addition/Deletion Ratio by Model
  - id: code_addition_deletion_ratio_by_model
    title: Code Addition/Deletion Ratio by Model
    description: Ratio closer to 1:1 might indicate more refactoring vs new code
    chart_type: horizontal_bar
    width: full
    data_source:
      type: function
      function: get_code_addition_deletion_ratio_by_model
    label_field: model
    value_field: ratio
    options:
      max_items: 15
      show_percentages: false

  # Language Distribution Evolution - simplified as horizontal bar for now
  - id: language_distribution_evolution
    title: Language Distribution (Top 10)
    description: Most used programming languages
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_language_distribution_summary
    label_field: language
    value_field: count
    options:
      max_items: 10
      show_percentages: true

  # File Bottlenecks - Files with highest modification times
  - id: file_bottlenecks
    title: File Bottlenecks
    description: Files with the most modifications and code changes
    chart_type: table
    width: half
    data_source:
      type: function
      function: get_file_bottlenecks
    options:
      max_items: 6
    columns:
      - field: filename
        title: File Name
      - field: workspace_name
        title: Workspace
      - field: times_changed
        title: Times Changed

  # Recent Workspaces (table)
  - id: recent_workspaces
    title: Recent Workspaces
    description: Workspaces with recent activity
    chart_type: table
    width: full
    data_source:
      type: function
      function: get_recent_workspaces
    options:
      max_items: 7
    columns:
      - field: workspace_name
        title: Workspace
        link: true
      - field: agent_used
        title: Agent(s)
      - field: session_count
        title: Sessions
      - field: turn_count
        title: Turns
      - field: total_code_loc
        title: LOC
      - field: updated_at
        title: Last Updated

  # Word Cloud - Most used words (cleaned text) with slicing by role/model
  - id: word_cloud_terms
    title: Word Cloud
    description: Word cloud; slice by user vs assistant models
    chart_type: word_cloud
    width: full
    data_source:
      type: function
      function: get_word_cloud_terms
    options:
      max_words: 300
      min_word_length: 4
      top_models: 5
      exclude_patterns:
        - "_"           # Exclude words containing underscores
        - "^[^a-z]"     # Exclude words starting with non-letters
        - "\\d{3,}"     # Exclude words with 3+ consecutive digits
        - "^(can|cannot|each|must|should|more|less|other|some|before|after|goes|going|call|called|calling|make|making|made|write|writing|wrote|look|looking|looked|think|thinking|want|wanted|need|needed|use|using|used|see|seeing|saw|try|trying|tried|get|getting|got|put|putting|set|setting|add|adding|added|run|running|take|taking|took|does|doing|done|did|know|knew|come|coming|came|give|giving|gave|tell|telling|told|find|finding|found|show|showing|shown|work|working|move|moving|change|changing|changed|create|creating|created|check|checking|checked|pass|passing|passed|return|returned|read|reading|update|updating|updated|send|sending|sent|open|opening|opened|close|closing|closed|start|starting|started|stop|stopped|load|loading|loaded|save|saving|saved|delete|deleting|deleted|remove|removing|removed|click|clicked|clicking|follow|following|followed|include|including|included|keep|keeping|kept|provide|providing|provided|allow|allowing|allowed|build|building|built|handle|handling|handled|ensure|ensuring|ensured|expect|expecting|expected|contain|containing|contained|define|defining|defined|enable|enabling|enabled|disable|disabling|disabled|test|testing|tested|debug|debugging|debugged|fix|fixing|fixed|implement|implementing|implemented|import|importing|imported|export|exporting|exported|install|installing|installed|copy|copying|copied|paste|pasting|pasted|select|selecting|selected|enter|entering|entered|press|pressing|pressed|hold|holding|held|wait|waiting|waited|print|printing|printed|display|displaying|displayed|render|rendering|rendered|parse|parsing|parsed|fetch|fetching|fetched|request|requesting|requested|respond|responding|responded|process|processing|processed|execute|executing|executed|init|initialize|initializing|initialized|configure|configuring|configured|setup|setting|connect|connecting|connected|disconnect|disconnecting|disconnected|listen|listening|emit|emitting|emitted|trigger|triggering|triggered|fire|firing|fired|dispatch|dispatching|dispatched|subscribe|subscribing|subscribed|publish|publishing|published|attach|attaching|attached|detach|detaching|detached|bind|binding|bound|wrap|wrapping|wrapped|extend|extending|extended|inherit|inheriting|inherited|override|overriding|overridden|apply|applying|applied|invoke|invoking|invoked|inject|injecting|injected|resolve|resolving|resolved|reject|rejecting|rejected|throw|throwing|thrown|catch|catching|caught|raise|raising|raised|log|logging|logged|trace|tracing|traced|assert|asserting|asserted|validate|validating|validated|verify|verifying|verified|confirm|confirming|confirmed|accept|accepting|accepted|deny|denying|denied|grant|granting|granted|revoke|revoking|revoked|access|accessing|accessed|query|querying|queried|filter|filtering|filtered|sort|sorting|sorted|group|grouping|grouped|merge|merging|merged|split|splitting|join|joining|joined|concat|concatenating|concatenated|append|appending|appended|prepend|prepending|prepended|insert|inserting|inserted|push|pushing|pushed|pop|popping|popped|shift|shifting|shifted|unshift|unshifting|unshifted|slice|slicing|sliced|splice|splicing|spliced|replace|replacing|replaced|match|matching|matched|search|searching|searched|locate|locating|located|seek|seeking|sought|scan|scanning|scanned|traverse|traversing|traversed|iterate|iterating|iterated|loop|looping|looped|repeat|repeating|repeated|continue|continuing|continued|break|breaking|broken|skip|skipping|skipped|jump|jumping|jumped|goto|branch|branching|branched|switch|switching|switched|toggle|toggling|toggled|flip|flipping|flipped|swap|swapping|swapped|rotate|rotating|rotated|translate|translating|translated|transform|transforming|transformed|convert|converting|converted|cast|casting|encode|encoding|encoded|decode|decoding|decoded|encrypt|encrypting|encrypted|decrypt|decrypting|decrypted|compress|compressing|compressed|decompress|decompressing|decompressed|serialize|serializing|serialized|deserialize|deserializing|deserialized|format|formatting|formatted|sanitize|sanitizing|sanitized|escape|escaping|escaped|unescape|unescaping|unescaped|normalize|normalizing|normalized|trim|trimming|trimmed|strip|stripping|stripped|pad|padding|padded|fill|filling|filled|empty|emptying|emptied|clear|clearing|cleared|reset|resetting|flush|flushing|flushed|refresh|refreshing|refreshed|reload|reloading|reloaded|restart|restarting|restarted|reboot|rebooting|rebooted|shutdown|shutting|recover|recovering|recovered|restore|restoring|restored|backup|backing|backed|sync|syncing|synced|async|await|awaiting|awaited|yield|yielding|yielded|spawn|spawning|spawned|fork|forking|forked|clone|cloning|cloned|duplicate|duplicating|duplicated|replicate|replicating|replicated|mirror|mirroring|mirrored|cache|caching|cached|store|storing|stored|retrieve|retrieving|retrieved|fetch|fetching|fetched|pull|pulling|pulled|grab|grabbing|grabbed|pick|picking|picked|choose|choosing|chose|chosen|determine|determining|determined|decide|deciding|decided|evaluate|evaluating|evaluated|assess|assessing|assessed|analyze|analyzing|analyzed|examine|examining|examined|inspect|inspecting|inspected|review|reviewing|reviewed|audit|auditing|audited|monitor|monitoring|monitored|track|tracking|tracked|observe|observing|observed|watch|watching|watched|listen|listening|listened|hear|hearing|heard|receive|receiving|received|accept|accepting|accepted|acknowledge|acknowledging|acknowledged|respond|responding|responded|reply|replying|replied|answer|answering|answered|ask|asking|asked|question|questioning|questioned|inquire|inquiring|inquired|consult|consulting|consulted|advise|advising|advised|recommend|recommending|recommended|suggest|suggesting|suggested|propose|proposing|proposed|offer|offering|offered|present|presenting|presented|demonstrate|demonstrating|demonstrated|illustrate|illustrating|illustrated|explain|explaining|explained|describe|describing|described|clarify|clarifying|clarified|elaborate|elaborating|elaborated|detail|detailing|detailed|specify|specifying|specified|indicate|indicating|indicated|signal|signaling|signaled|notify|notifying|notified|alert|alerting|alerted|warn|warning|warned|inform|informing|informed|report|reporting|reported|announce|announcing|announced|declare|declaring|declared|state|stating|stated|mention|mentioning|mentioned|note|noting|noted|remark|remarking|remarked|comment|commenting|commented|annotate|annotating|annotated|label|labeling|labeled|tag|tagging|tagged|mark|marking|marked|flag|flagging|flagged|highlight|highlighting|highlighted|emphasize|emphasizing|emphasized|stress|stressing|stressed|focus|focusing|focused|concentrate|concentrating|concentrated|aim|aiming|aimed|target|targeting|targeted|direct|directing|directed|guide|guiding|guided|lead|leading|led|steer|steering|steered|navigate|navigating|navigated|orient|orienting|oriented|position|positioning|positioned|place|placing|placed|locate|locating|located|situate|situating|situated|arrange|arranging|arranged|organize|organizing|organized|order|ordering|ordered|structure|structuring|structured|compose|composing|composed|construct|constructing|constructed|assemble|assembling|assembled|compile|compiling|compiled|gather|gathering|gathered|collect|collecting|collected|accumulate|accumulating|accumulated|aggregate|aggregating|aggregated|combine|combining|combined|consolidate|consolidating|consolidated|integrate|integrating|integrated|incorporate|incorporating|incorporated|embed|embedding|embedded|nest|nesting|nested|wrap|wrapping|wrapped|enclose|enclosing|enclosed|contain|containing|contained|hold|holding|held|carry|carrying|carried|bear|bearing|bore|support|supporting|supported|sustain|sustaining|sustained|maintain|maintaining|maintained|preserve|preserving|preserved|protect|protecting|protected|secure|securing|secured|guard|guarding|guarded|shield|shielding|shielded|defend|defending|defended|prevent|preventing|prevented|avoid|avoiding|avoided|evade|evading|evaded|escape|escaping|escaped|exit|exiting|exited|leave|leaving|left|quit|quitting|abandon|abandoning|abandoned|discard|discarding|discarded|dispose|disposing|disposed|release|releasing|released|free|freeing|freed|liberate|liberating|liberated|unlock|unlocking|unlocked|lock|locking|locked|restrict|restricting|restricted|limit|limiting|limited|constrain|constraining|constrained|bound|bounding|bounded|cap|capping|capped|throttle|throttling|throttled|regulate|regulating|regulated|control|controlling|controlled|manage|managing|managed|administer|administering|administered|govern|governing|governed|rule|ruling|ruled|dominate|dominating|dominated|command|commanding|commanded|dictate|dictating|dictated|instruct|instructing|instructed|teach|teaching|taught|educate|educating|educated|train|training|trained|coach|coaching|coached|mentor|mentoring|mentored|tutor|tutoring|tutored|assist|assisting|assisted|help|helping|helped|aid|aiding|aided|serve|serving|served|cater|catering|catered|accommodate|accommodating|accommodated|satisfy|satisfying|satisfied|fulfill|fulfilling|fulfilled|meet|meeting|met|achieve|achieving|achieved|accomplish|accomplishing|accomplished|attain|attaining|attained|reach|reaching|reached|arrive|arriving|arrived|approach|approaching|approached|advance|advancing|advanced|proceed|proceeding|proceeded|progress|progressing|progressed|develop|developing|developed|evolve|evolving|evolved|grow|growing|grew|grown|expand|expanding|expanded|increase|increasing|increased|boost|boosting|boosted|enhance|enhancing|enhanced|improve|improving|improved|upgrade|upgrading|upgraded|optimize|optimizing|optimized|refine|refining|refined|polish|polishing|polished|perfect|perfecting|perfected|complete|completing|completed|finish|finishing|finished|end|ending|ended|conclude|concluding|concluded|terminate|terminating|terminated|abort|aborting|aborted|cancel|canceling|cancelled|canceled|revoke|revoking|revoked|undo|undoing|undone|redo|redoing|redone|revert|reverting|reverted|rollback|rolling|rolled)$"  # Exclude common verbs and words

  # Workspace breakdown by session count
    # - id: workspace_sessions
    #   title: Sessions by Workspace
    #   description: Distribution of sessions across workspaces
    #   chart_type: horizontal_bar
    #   width: half
    #   data_source:
    #     type: function
    #     function: get_workspace_session_distribution
    #   options:
    #     max_items: 10
    #     show_percentages: true
    #     integer_scale: true  # Show whole numbers only on x-axis

  # Code metrics by workspace
    # - id: code_lines_by_workspace
    #   title: Code Contribution by Workspace
    #   description: Lines of code generated by AI per workspace
    #   chart_type: horizontal_bar
    #   width: half
    #   data_source:
    #     type: function
    #     function: get_workspace_code_distribution
