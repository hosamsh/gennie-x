# System Overview Dashboard Configuration
# Landing page showing overall system metrics across all workspaces

dashboard:
  id: system_extraction
  name: System Overview
  description: Overall system metrics across all extracted workspaces and sessions
  icon: chart-bar
  is_system_level: true     # Flag to indicate this is a system-wide dashboard

# Primary metrics row - key statistics at the top
metrics:
  - id: total_workspaces
    title: Workspaces
    description: Total extracted workspaces
    data_source:
      type: function
      function: get_system_stats
      field: total_workspaces
    format: number
    icon: folder
    color: blue

  - id: total_sessions
    title: Sessions
    description: Total chat sessions
    data_source:
      type: function
      function: get_system_stats
      field: total_sessions
    format: number
    icon: message-square
    color: green

  - id: total_turns
    title: Turns
    description: Total turns user/assistant
    data_source:
      type: function
      function: get_system_stats
      field: total_turns
    format: number
    icon: messages
    color: purple

  - id: total_code_lines
    title: Lines of Code
    description: Total lines of code generated
    data_source:
      type: function
      function: get_system_stats
      field: total_code_lines
    format: number
    icon: code
    color: cyan

  - id: agentic_coding_time_days
    title: Agentic Time
    description: Total days spent coding by agents
    data_source:
      type: function
      function: get_agentic_coding_time_stats
      field: total_days
    format: number
    icon: timer
    color: orange

  - id: top_agent
    title: Top Agent
    description: Most frequently used agent
    data_source:
      type: function
      function: get_top_agent_stats
      field: top_agent
    subtitle_field: percentage
    format: text
    icon: smart_toy
    color: purple

  - id: top_model
    title: Top Model
    description: Most frequently used AI model
    data_source:
      type: function
      function: get_top_model_stats
      field: top_model
    subtitle_field: percentage
    format: text
    text_size: sm
    icon: psychology
    color: pink

# Charts section
charts:

  # Activity Heatmap - agentic time minutes by date x hour
  - id: activity_heatmap_agentic_time
    title: Activity Heatmap
    description: Weekly minutes spent with agentic coding by date/week and hour
    chart_type: heatmap
    width: full
    data_source:
      type: function
      function: get_activity_heatmap_agentic_time
    x_field: date
    y_field: hour
    value_field: minutes
    options:
      color: '#3b82f6' # Blue
      cell_size: 14

  # Agent usage distribution (Copilot vs Cursor)
  - id: agent_distribution
    title: Agent Usage
    description: Distribution by AI coding assistant
    chart_type: doughnut
    width: half
    data_source:
      type: function
      function: get_agent_distribution

  # Model usage distribution
  - id: model_usage
    title: Model Usage
    description: Top AI models used across all agents and conversations
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_model_distribution
    options:
      max_items: 10

  # Agentic coding time by agent (Copilot vs Cursor vs Claude...)
  - id: agentic_coding_time_per_agent
    title: Coding Time by Agent
    description: Total time agents spent handling user requests (hours)
    chart_type: pie
    width: half
    data_source:
      type: function
      function: get_agentic_coding_time_per_agent
    options:
      max_items: 10
      show_percentages: trues

  # Agentic coding time by model (response_time_ms aggregated)
  - id: agentic_coding_time_per_model
    title: Coding Time by Model
    description: Total time a particular coding model spent handling user requests (hours)
    chart_type: pie
    width: half
    data_source:
      type: function
      function: get_agentic_coding_time_per_model
    options:
      max_items: 10
      show_percentages: true

  # Workspace breakdown by session count
  - id: workspace_sessions
    title: Sessions by Workspace
    description: Distribution of sessions across workspaces
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_workspace_session_distribution
    options:
      max_items: 10
      show_percentages: true


  # Code metrics by workspace
  - id: code_lines_by_workspace
    title: Code Contribution by Workspace
    description: Lines of code generated by AI per workspace
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_workspace_code_distribution

  # Code velocity timeline (net code growth per day)
  - id: code_velocity_timeline
    title: Code Velocity Timeline
    description: Daily net code growth (added - removed)
    chart_type: line
    width: full
    x_field: date
    datasets:
      - label: Net Lines Added
        field: net_growth
        color: 'rgba(34, 197, 94, 0.8)' # Green
        fill: false
    data_source:
      type: function
      function: get_code_velocity_timeline

  # Activity timeline - stacked bar chart showing sessions, turns, and files touched over time
  - id: session_timeline
    title: Activity Timeline
    description: Sessions, turns, and files touched over time
    chart_type: stacked_bar_timeline
    width: full
    x_field: date
    datasets:
      - label: Sessions
        field: sessions
        color: 'rgba(59, 130, 246, 0.8)' # Blue
        fill: false
      - label: Turns
        field: turns
        color: 'rgba(168, 85, 247, 0.8)' # Purple
        fill: false
      - label: Files Touched
        field: files_touched
        color: 'rgba(234, 179, 8, 0.8)' # Yellow
        fill: false
    data_source:
      type: function
      function: get_session_timeline

  # Model Productivity Matrix (table) - LOC per code turn by model
  - id: model_productivity_matrix
    title: Model Productivity Matrix
    description: LOC added per code turn by model
    chart_type: table
    width: full
    data_source:
      type: function
      function: get_model_productivity_matrix
    columns:
      - field: model
        title: Model
      - field: loc_per_turn
        title: LOC/Turn
      - field: total_loc_added
        title: Total LOC Added
      - field: code_turns
        title: Code Turns

  # Model Complexity Impact (scatter) - delta complexity vs lines changed
  - id: model_complexity_impact
    title: Model Complexity Impact
    description: Complexity delta vs lines changed (one point per model)
    chart_type: scatter
    width: half
    data_source:
      type: function
      function: get_model_complexity_impact
    x_field: lines_changed
    y_field: complexity_delta
    label_field: model

  # Code Addition/Deletion Ratio by Model
  - id: code_addition_deletion_ratio_by_model
    title: Code Addition/Deletion Ratio by Model
    description: Ratio closer to 1:1 might indicate more refactoring vs new code
    chart_type: horizontal_bar
    width: full
    data_source:
      type: function
      function: get_code_addition_deletion_ratio_by_model
    label_field: model
    value_field: ratio
    options:
      max_items: 15
      show_percentages: false

  # Language Distribution Evolution - simplified as horizontal bar for now
  # TODO: Implement proper stacked area chart with dynamic datasets
  - id: language_distribution_evolution
    title: Language Distribution (Top 10)
    description: Most used programming languages
    chart_type: horizontal_bar
    width: half
    data_source:
      type: function
      function: get_language_distribution_summary
    label_field: language
    value_field: count
    options:
      max_items: 10
      show_percentages: true

  # File Bottlenecks - Files with highest modification times
  - id: file_bottlenecks
    title: File Bottlenecks
    description: Files with the most modifications and code changes
    chart_type: table
    width: half
    data_source:
      type: function
      function: get_file_bottlenecks
    options:
      max_items: 6
    columns:
      - field: filename
        title: File Name
      - field: workspace_name
        title: Workspace
      - field: times_changed
        title: Times Changed

  # Recent Workspaces (table)
  - id: recent_workspaces
    title: Recent Workspaces
    description: Workspaces with recent activity
    chart_type: table
    width: full
    data_source:
      type: function
      function: get_recent_workspaces
    options:
      max_items: 7
    columns:
      - field: workspace_name
        title: Workspace
        link: true
      - field: agent_used
        title: Agent(s)
      - field: session_count
        title: Sessions
      - field: turn_count
        title: Turns
      - field: total_code_loc
        title: LOC
      - field: updated_at
        title: Last Updated

  # Word Cloud - Most used words (cleaned text) with slicing by role/model
  - id: word_cloud_terms
    title: Word Cloud
    description: Word cloud; slice by user vs assistant models
    chart_type: word_cloud
    width: full
    data_source:
      type: function
      function: get_word_cloud_terms
    options:
      max_words: 300
      min_word_length: 4
      top_models: 5
      exclude_patterns:
        - "_"           # Exclude words containing underscores
        - "^[^a-z]"     # Exclude words starting with non-letters
        - "\\d{3,}"     # Exclude words with 3+ consecutive digits
